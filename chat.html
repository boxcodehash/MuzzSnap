<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MuzzSnap - Terminal 3D Edition</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Orbitron:wght@700;900&family=Inter:wght@400;700&display=swap');
    
    :root { 
      --muzz-red: #ff0000; 
      --deep-black: #050505; 
      --panel-bg: #0c0c0c; 
      --neon-green: #39ff14; 
      --ryachu-gold: #ffcc00; 
    }
    
    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0f 100%);
      color: white; 
      overflow: hidden; 
      margin: 0;
      position: relative;
    }

    /* Animated Background Grid */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255, 0, 0, 0.15) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 0, 0.15) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      opacity: 0.3;
      z-index: 0;
    }

    /* Floating Orbs */
    body::after {
      content: '';
      position: fixed;
      top: 10%;
      left: 5%;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(255,0,0,0.3) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(60px);
      animation: floatOrb 10s ease-in-out infinite;
      z-index: 0;
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    @keyframes floatOrb {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(100px, 50px) scale(1.2); }
    }

    @keyframes borderGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.3), inset 0 0 20px rgba(255, 0, 0, 0.05); }
      50% { box-shadow: 0 0 40px rgba(255, 0, 0, 0.6), inset 0 0 30px rgba(255, 0, 0, 0.1); }
    }

    @keyframes textGlow {
      0%, 100% { text-shadow: 0 0 20px rgba(255, 0, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.4); }
      50% { text-shadow: 0 0 30px rgba(255, 0, 0, 1), 0 0 60px rgba(255, 0, 0, 0.6); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(200%); }
    }

    .panel-3d {
      background: rgba(12, 12, 12, 0.8);
      backdrop-filter: blur(20px);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 2px rgba(255, 255, 255, 0.05),
        0 0 0 1px rgba(255, 0, 0, 0.1);
      border-radius: 24px;
      position: relative;
      animation: borderGlow 3s ease-in-out infinite;
      transform-style: preserve-3d;
      z-index: 1;
    }

    .panel-3d::before {
      content: '';
      position: absolute;
      inset: -1px;
      background: linear-gradient(135deg, rgba(255,0,0,0.2), transparent, rgba(255,0,0,0.1));
      border-radius: 24px;
      z-index: -1;
      animation: shimmer 3s infinite;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .panel-3d:hover::before {
      opacity: 1;
    }

    .logo-3d {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 1.5rem;
      letter-spacing: -0.05em;
      background: linear-gradient(135deg, #fff 0%, #ff0000 50%, #fff 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 3s ease infinite, textGlow 2s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .ryachu-name {
      color: var(--ryachu-gold);
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.8), 0 0 30px rgba(255, 204, 0, 0.4);
      font-weight: 900;
      animation: textGlow 2s ease-in-out infinite;
    }

    .channel-btn-3d {
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideIn 0.5s ease-out forwards;
    }

    .channel-btn-3d::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,0,0,0.2), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s;
    }

    .channel-btn-3d:hover::after {
      transform: translateX(100%);
    }

    .channel-btn-3d.active {
      background: linear-gradient(135deg, rgba(255,0,0,0.2), rgba(0,0,0,0.4));
      border: 2px solid rgba(255,0,0,0.6);
      color: var(--muzz-red);
      box-shadow: 0 0 20px rgba(255,0,0,0.3), inset 0 0 20px rgba(255,0,0,0.1);
      transform: translateX(5px) scale(1.05);
    }

    .bubble-3d {
      padding: 12px 18px;
      border-radius: 20px;
      margin-bottom: 6px;
      max-width: 85%;
      word-wrap: break-word;
      position: relative;
      animation: fadeIn 0.3s ease-out;
      transform-style: preserve-3d;
    }

    .bubble-3d::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 20px;
      padding: 2px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .bubble-3d:hover::before {
      opacity: 1;
    }

    .bubble-3d.me {
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1);
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .bubble-3d.other {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(10px);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .hacker-input {
      font-family: 'Fira Code', monospace;
      color: var(--neon-green) !important;
      text-shadow: 0 0 10px rgba(57, 255, 20, 0.3);
    }

    .icon-glow {
      filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.6));
      animation: float 3s ease-in-out infinite;
    }

    .send-btn-3d {
      background: linear-gradient(135deg, #ff0000 0%, #990000 100%);
      box-shadow: 
        0 0 20px rgba(255, 0, 0, 0.4),
        0 10px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 2px rgba(255, 255, 255, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .send-btn-3d::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s;
    }

    .send-btn-3d:hover {
      transform: scale(1.1);
      box-shadow: 
        0 0 30px rgba(255, 0, 0, 0.6),
        0 15px 30px rgba(0, 0, 0, 0.4),
        inset 0 1px 2px rgba(255, 255, 255, 0.3);
    }

    .send-btn-3d:hover::before {
      transform: translateX(100%);
    }

    .send-btn-3d:active {
      transform: scale(0.95);
    }

    .emoji-btn {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      filter: grayscale(1);
    }

    .emoji-btn:hover {
      transform: scale(1.3) rotate(10deg);
      filter: grayscale(0) drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
    }

    .user-dot {
      animation: float 2s ease-in-out infinite;
      box-shadow: 0 0 10px currentColor;
    }

    .loading-screen {
      animation: fadeIn 0.5s ease-out;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
    ::-webkit-scrollbar-thumb { 
      background: linear-gradient(180deg, var(--muzz-red), #990000); 
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }
    ::-webkit-scrollbar-thumb:hover { background: var(--muzz-red); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyAe1-JfNde0NKIMdE7phfEXlm9JaqUH0jY",
      authDomain: "pulsari.firebaseapp.com",
      databaseURL: "https://pulsari-default-rtdb.firebaseio.com",
      projectId: "pulsari",
      storageBucket: "pulsari.firebasestorage.app",
      messagingSenderId: "824306321233",
      appId: "1:824306321233:web:2c9bfa02170a17d560b570"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    const RYACHU_WALLET = "0x208157b5ec396759e8754058108ecf53e32392ff".toLowerCase();
    const ITSUKI_WALLET = "0xfab5835ca14fb3f9f478c5e4d733734e6394e03f".toLowerCase();
    const QUICK_EMOJIS = ["ðŸ”¥", "ðŸš€", "ðŸ’Ž", "ðŸ’»", "âš¡", "ðŸ¤–", "ðŸ”´", "ðŸ‘‘"];

    const CHANNELS = [
      { id: "general", name: "GENERAL", icon: "fa-hashtag" },
      { id: "spanish", name: "SPANISH", icon: "fa-language" },
      { id: "english", name: "ENGLISH", icon: "fa-globe" },
      { id: "crypto", name: "CRYPTO", icon: "fa-bitcoin-sign" }
    ];

    function App() {
      const [user, setUser] = useState(null);
      const [selectedChannel, setSelectedChannel] = useState(CHANNELS[0]);
      const [messages, setMessages] = useState([]);
      const [onlineUsers, setOnlineUsers] = useState([]);
      const [inputText, setInputText] = useState("");
      const [isMobileMenu, setIsMobileMenu] = useState(false);
      const dummyRef = useRef(null);

      useEffect(() => {
        const wallet = sessionStorage.getItem('muzz_wallet_address');
        
        if (!wallet) {
          window.location.href = 'index.html';
          return;
        }

        auth.signInAnonymously().then(async (userCredential) => {
          const uid = userCredential.user.uid;
          const walletKey = wallet.toLowerCase();
          
          const myPresenceRef = database.ref(`presence/${uid}`);
          const connectedRef = database.ref(".info/connected");

          connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
              myPresenceRef.onDisconnect().remove();
              
              let finalUsername = `Node_${wallet.slice(-4)}`;
              let isAdmin = false;

              if (walletKey === RYACHU_WALLET) {
                finalUsername = "Ryachu";
                isAdmin = true;
              } else if (walletKey === ITSUKI_WALLET) {
                finalUsername = "Itsuki";
                isAdmin = true;
              }

              const userData = {
                username: finalUsername,
                wallet: walletKey,
                online: true,
                uid: uid,
                isRyachu: isAdmin
              };

              myPresenceRef.set(userData);
              setUser({ ...userData, address: wallet });
            }
          });
        });

        database.ref('presence').on('value', snap => {
          const data = snap.val();
          setOnlineUsers(data ? Object.values(data) : []);
        });
      }, []);

      useEffect(() => {
        if (!user) return;
        const msgRef = database.ref('messages/' + selectedChannel.id).limitToLast(50);
        msgRef.on('value', snap => {
          const data = snap.val();
          setMessages(data ? Object.keys(data).map(k => ({ id: k, ...data[k] })) : []);
        });
        return () => msgRef.off();
      }, [selectedChannel, user]);

      useEffect(() => { 
        dummyRef.current?.scrollIntoView({ behavior: 'smooth' }); 
      }, [messages]);

      const handleSend = async () => {
        if (!inputText.trim()) return;
        await database.ref('messages/' + selectedChannel.id).push({
          content: inputText,
          userId: user.uid,
          username: user.username,
          isRyachu: user.isRyachu,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        setInputText("");
      };

      if (!user) return (
        <div className="loading-screen h-screen bg-gradient-to-br from-black via-red-950 to-black flex flex-col items-center justify-center">
          <div className="icon-glow mb-6">
            <i className="fas fa-ghost text-red-600 text-6xl"></i>
          </div>
          <div className="text-red-600 font-mono text-sm tracking-[0.4em] animate-pulse">
            VALIDATING_ENCRYPTED_SESSION...
          </div>
          <div className="mt-4 flex gap-2">
            <div className="w-2 h-2 bg-red-600 rounded-full animate-bounce" style={{animationDelay: '0s'}}></div>
            <div className="w-2 h-2 bg-red-600 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
            <div className="w-2 h-2 bg-red-600 rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
          </div>
        </div>
      );

      return (
        <div className="flex h-screen p-2 lg:p-4 gap-4 overflow-hidden" style={{position: 'relative', zIndex: 1}}>
          
          {/* SIDEBAR */}
          <aside className={`fixed lg:relative z-50 inset-y-0 left-0 w-72 panel-3d p-6 flex flex-col transition-all duration-500 ${isMobileMenu ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}`}>
            <div className="mb-10 flex items-center gap-4">
              <div className="w-12 h-12 bg-gradient-to-br from-red-600 to-red-900 rounded-2xl flex items-center justify-center icon-glow">
                <i className="fas fa-ghost text-white text-xl"></i>
              </div>
              <h1 className="logo-3d">
                MUZZ<span style={{color: '#ff0000'}}>SNAP</span>
              </h1>
            </div>

            <div className="flex-1 overflow-y-auto pr-2">
              <p className="text-[10px] text-gray-500 font-bold tracking-[0.3em] mb-4 uppercase" style={{textShadow: '0 0 10px rgba(255,0,0,0.3)'}}>
                Access_Channels
              </p>
              {CHANNELS.map((ch, idx) => (
                <button 
                  key={ch.id} 
                  onClick={() => { setSelectedChannel(ch); setIsMobileMenu(false); }} 
                  className={`channel-btn-3d w-full flex items-center gap-3 px-5 py-4 rounded-xl text-sm font-bold mb-2 transition-all ${selectedChannel.id === ch.id ? 'active' : 'text-gray-400 hover:text-gray-200 hover:bg-white/5'}`}
                  style={{animationDelay: `${idx * 0.1}s`}}
                >
                  <i className={`fas ${ch.icon} text-lg`}></i>
                  <span>{ch.name}</span>
                </button>
              ))}

              <p className="text-[10px] text-gray-500 font-bold tracking-[0.3em] mt-10 mb-4 uppercase" style={{textShadow: '0 0 10px rgba(255,0,0,0.3)'}}>
                Nodes_Online ({onlineUsers.length})
              </p>
              {onlineUsers.map((u, i) => (
                <div key={i} className={`flex items-center gap-3 text-xs px-3 py-2 mb-1 rounded-lg hover:bg-white/5 transition-all ${u.isRyachu ? 'ryachu-name' : 'text-gray-400'}`}>
                  <div className={`user-dot w-2 h-2 rounded-full ${u.isRyachu ? 'bg-yellow-400' : 'bg-green-500'}`} style={{animationDelay: `${i * 0.1}s`}}></div>
                  <span className="font-bold">{u.username}</span>
                </div>
              ))}
            </div>

            <button 
              onClick={() => {sessionStorage.clear(); window.location.reload()}} 
              className="mt-6 w-full py-3 text-xs font-bold border-2 border-red-900/50 text-red-600 rounded-xl uppercase tracking-wider hover:bg-red-900/20 hover:border-red-600 transition-all hover:scale-105"
              style={{textShadow: '0 0 10px rgba(255,0,0,0.5)'}}
            >
              <i className="fas fa-power-off mr-2"></i>
              Disconnect
            </button>
          </aside>

          {/* CHAT MAIN */}
          <main className="flex-1 panel-3d flex flex-col overflow-hidden relative">
            <header className="h-16 flex items-center justify-between px-8 bg-gradient-to-r from-black/40 to-red-900/20 backdrop-blur-xl border-b border-red-900/30">
              <div className="flex items-center gap-4">
                <button onClick={() => setIsMobileMenu(true)} className="lg:hidden text-red-600 text-xl hover:scale-110 transition-transform">
                  <i className="fas fa-bars"></i>
                </button>
                <i className={`fas ${selectedChannel.icon} text-red-600 text-lg icon-glow`}></i>
                <h2 className="text-base font-bold tracking-[0.3em] text-red-600" style={{textShadow: '0 0 20px rgba(255,0,0,0.5)'}}>
                  #{selectedChannel.name}
                </h2>
              </div>
              <div className="text-[10px] font-mono text-gray-500 tracking-wider">
                {user.isRyachu ? (
                  <span className="ryachu-name flex items-center gap-2">
                    <i className="fas fa-crown"></i> ROOT_ADMIN
                  </span>
                ) : (
                  <span>ADDR: {user.address.slice(0,6)}...{user.address.slice(-4)}</span>
                )}
              </div>
            </header>

            <div className="flex-1 overflow-y-auto p-4 lg:p-8 flex flex-col">
              {messages.map(msg => {
                const isMe = msg.userId === user.uid;
                return (
                  <div key={msg.id} className={`flex flex-col ${isMe ? 'items-end' : 'items-start'} mb-4`}>
                    {!isMe && (
                      <span className={`text-[10px] font-bold ml-2 mb-1 uppercase tracking-wider ${msg.isRyachu ? 'ryachu-name' : 'text-gray-500'}`}>
                        {msg.isRyachu && <i className="fas fa-crown mr-1"></i>}
                        {msg.username}
                      </span>
                    )}
                    <div className={`bubble-3d ${isMe ? 'me' : 'other'}`}>
                      <p className="text-sm leading-relaxed">{msg.content}</p>
                    </div>
                  </div>
                );
              })}
              <div ref={dummyRef}></div>
            </div>

            <div className="p-5 bg-gradient-to-t from-black/60 to-transparent backdrop-blur-sm">
              <div className="flex gap-3 mb-4 px-2 justify-center">
                {QUICK_EMOJIS.map(emoji => (
                  <button 
                    key={emoji} 
                    onClick={() => setInputText(inputText + emoji)} 
                    className="emoji-btn text-2xl"
                  >
                    {emoji}
                  </button>
                ))}
              </div>

              <div className="flex items-center bg-black/60 border-2 border-red-900/30 rounded-2xl p-2 pl-5 backdrop-blur-xl" style={{boxShadow: 'inset 0 2px 10px rgba(0,0,0,0.5), 0 0 20px rgba(255,0,0,0.1)'}}>
                <input 
                  value={inputText} 
                  onChange={e => setInputText(e.target.value)} 
                  onKeyDown={e => e.key === 'Enter' && handleSend()} 
                  placeholder="Transmit encrypted message..." 
                  className="flex-1 bg-transparent border-none focus:ring-0 text-sm hacker-input placeholder-green-900" 
                />
                <button 
                  onClick={handleSend} 
                  className="send-btn-3d w-12 h-12 rounded-xl flex items-center justify-center ml-2"
                >
                  <i className="fas fa-paper-plane text-sm"></i>
                </button>
              </div>
            </div>
          </main>
          
          {isMobileMenu && (
            <div 
              onClick={() => setIsMobileMenu(false)} 
              className="fixed inset-0 bg-black/90 z-40 lg:hidden backdrop-blur-sm"
              style={{animation: 'fadeIn 0.3s ease-out'}}
            ></div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
